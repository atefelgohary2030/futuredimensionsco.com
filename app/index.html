<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#061427">

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="/android-chrome-192x192.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Future Dimensions">

  <title>Future Dimensions App</title>

  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 24px; background: #061427; color: #fff; }
    .box { max-width: 560px; margin: 0 auto; }
    .card { background: rgba(255,255,255,.08); padding: 18px; border-radius: 14px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 14px; }
    a.btn, button.btn { display: inline-block; padding: 12px 14px; border-radius: 12px; background: #1ea7ff; color: #001018; text-decoration: none; font-weight: 700; border: 0; cursor: pointer; }
    button.btn[disabled] { opacity: .5; cursor: not-allowed; }
    .hint { opacity: .85; font-size: 14px; line-height: 1.6; }
    .small { opacity: .75; font-size: 13px; margin-top: 10px; }
  </style>
</head>

<body>
  <div class="box">
    <h1>Future Dimensions App</h1>

    <div class="card">
      <div class="hint">
        Android: افتح الصفحة دي في Chrome، لو ظهر زر Install اضغطه<br>
        iPhone: لازم Safari ثم Share ثم Add to Home Screen
      </div>

      <div class="row">
        <button class="btn" id="installBtn" disabled>Install</button>
        <a class="btn" href="/">Open website</a>
      </div>

      <div class="small" id="status">Preparing…</div>
    </div>
  </div>

  <script>
    const statusEl = document.getElementById("status")
    const installBtn = document.getElementById("installBtn")

    function setStatus(msg) {
      if (statusEl) statusEl.textContent = msg
    }

    // iPhone standalone check: if opened from Home Screen, jump to main site
    const isIosStandalone = window.navigator.standalone === true
    const isStandalone = isIosStandalone || window.matchMedia("(display-mode: standalone)").matches
    if (isStandalone) {
      location.replace("/")
    }

    // Register service worker (mainly for Android install criteria)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js", { scope: "/" })
        .then(() => setStatus("Ready"))
        .catch(() => setStatus("Service worker failed. On iPhone you can still add to Home Screen"))
    } else {
      setStatus("Use Safari Share then Add to Home Screen (iPhone) or Chrome Install (Android)")
    }

    // Android install button
    let deferredPrompt = null
    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault()
      deferredPrompt = e
      if (installBtn) installBtn.disabled = false
      setStatus("Install is available (Android)")
    })

    if (installBtn) {
      installBtn.addEventListener("click", async () => {
        if (!deferredPrompt) return
        deferredPrompt.prompt()
        await deferredPrompt.userChoice
        deferredPrompt = null
        installBtn.disabled = true
        setStatus("If installed, open it from your Home Screen")
      })
    }

    window.addEventListener("appinstalled", () => {
      setStatus("Installed successfully")
    })
  </script>
</body>
</html>
